00000000  2f 2a 20 2a 2a 2a 2a 2a  2a 2a 2a 2a 2a 2a 2a 2a  |/* *************|
00000010  2a 2a 2a 2a 2a 2a 2a 2a  2a 2a 2a 2a 2a 2a 2a 2a  |****************|
*
00000040  2a 2a 2a 2a 2a 2a 2a 2a  2a 2a 2a 2a 2a 20 2a 2f  |************* */|
00000050  0a 2f 2a 20 20 20 20 20  20 20 20 20 20 20 20 20  |./*             |
00000060  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
*
00000090  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 2a  |               *|
000000a0  2f 0a 2f 2a 20 20 20 20  20 20 20 20 20 20 20 20  |/./*            |
000000b0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
*
000000d0  20 20 20 20 20 20 20 20  20 20 20 20 3a 3a 3a 20  |            ::: |
000000e0  20 20 20 20 20 3a 3a 3a  3a 3a 3a 3a 3a 20 20 20  |     ::::::::   |
000000f0  2a 2f 0a 2f 2a 20 20 20  72 65 64 5f 62 6c 61 63  |*/./*   red_blac|
00000100  6b 5f 72 65 6d 6f 76 65  2e 63 20 20 20 20 20 20  |k_remove.c      |
00000110  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000120  20 20 20 20 20 20 20 20  20 20 20 3a 2b 3a 20 20  |           :+:  |
00000130  20 20 20 20 3a 2b 3a 20  20 20 20 3a 2b 3a 20 20  |    :+:    :+:  |
00000140  20 2a 2f 0a 2f 2a 20 20  20 20 20 20 20 20 20 20  | */./*          |
00000150  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
*
00000170  20 20 20 20 20 20 20 20  20 20 2b 3a 2b 20 2b 3a  |          +:+ +:|
00000180  2b 20 20 20 20 20 20 20  20 20 2b 3a 2b 20 20 20  |+         +:+   |
00000190  20 20 2a 2f 0a 2f 2a 20  20 20 42 79 3a 20 61 6d  |  */./*   By: am|
000001a0  61 72 74 69 6e 6f 20 3c  61 6d 61 72 74 69 6e 6f  |artino <amartino|
000001b0  40 73 74 75 64 65 6e 74  2e 34 32 2e 66 72 3e 20  |@student.42.fr> |
000001c0  20 20 20 20 20 20 20 20  20 2b 23 2b 20 20 2b 3a  |         +#+  +:|
000001d0  2b 20 20 20 20 20 20 20  2b 23 2b 20 20 20 20 20  |+       +#+     |
000001e0  20 20 20 2a 2f 0a 2f 2a  20 20 20 20 20 20 20 20  |   */./*        |
000001f0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
*
00000210  20 20 20 20 20 20 20 20  2b 23 2b 23 2b 23 2b 23  |        +#+#+#+#|
00000220  2b 23 2b 20 20 20 2b 23  2b 20 20 20 20 20 20 20  |+#+   +#+       |
00000230  20 20 20 20 2a 2f 0a 2f  2a 20 20 20 43 72 65 61  |    */./*   Crea|
00000240  74 65 64 3a 20 32 30 32  30 2f 30 32 2f 32 33 20  |ted: 2020/02/23 |
00000250  31 35 3a 34 30 3a 35 33  20 62 79 20 61 6d 61 72  |15:40:53 by amar|
00000260  74 69 6e 6f 20 20 20 20  20 20 20 20 20 20 23 2b  |tino          #+|
00000270  23 20 20 20 20 23 2b 23  20 20 20 20 20 20 20 20  |#    #+#        |
00000280  20 20 20 20 20 2a 2f 0a  2f 2a 20 20 20 55 70 64  |     */./*   Upd|
00000290  61 74 65 64 3a 20 32 30  32 30 2f 30 33 2f 30 31  |ated: 2020/03/01|
000002a0  20 31 39 3a 33 37 3a 30  31 20 62 79 20 61 6d 61  | 19:37:01 by ama|
000002b0  72 74 69 6e 6f 64 20 20  20 20 20 20 20 20 23 23  |rtinod        ##|
000002c0  23 20 20 20 23 23 23 23  23 23 23 23 2e 66 72 20  |#   ########.fr |
000002d0  20 20 20 20 20 20 2a 2f  0a 2f 2a 20 20 20 20 20  |      */./*     |
000002e0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
*
00000320  20 20 20 20 20 20 20 2a  2f 0a 2f 2a 20 2a 2a 2a  |       */./* ***|
00000330  2a 2a 2a 2a 2a 2a 2a 2a  2a 2a 2a 2a 2a 2a 2a 2a  |****************|
*
00000370  2a 2a 2a 2a 2a 2a 2a 20  2a 2f 0a 0a 23 69 6e 63  |******* */..#inc|
00000380  6c 75 64 65 20 22 62 74  72 65 65 2e 68 22 0a 0a  |lude "btree.h"..|
00000390  73 74 61 74 69 63 20 76  6f 69 64 09 09 09 72 65  |static void...re|
000003a0  70 6c 61 63 65 5f 6e 6f  64 65 28 74 5f 72 62 5f  |place_node(t_rb_|
000003b0  74 72 65 65 20 2a 6e 6f  64 65 2c 20 74 5f 72 62  |tree *node, t_rb|
000003c0  5f 74 72 65 65 20 2a 63  68 69 6c 64 29 0a 7b 0a  |_tree *child).{.|
000003d0  09 63 68 69 6c 64 2d 3e  70 61 72 65 6e 74 20 3d  |.child->parent =|
000003e0  20 6e 6f 64 65 2d 3e 70  61 72 65 6e 74 3b 0a 09  | node->parent;..|
000003f0  69 66 20 28 6e 6f 64 65  20 3d 3d 20 6e 6f 64 65  |if (node == node|
00000400  2d 3e 70 61 72 65 6e 74  2d 3e 6c 65 66 74 29 0a  |->parent->left).|
00000410  09 09 6e 6f 64 65 2d 3e  70 61 72 65 6e 74 2d 3e  |..node->parent->|
00000420  6c 65 66 74 20 3d 20 63  68 69 6c 64 3b 0a 09 65  |left = child;..e|
00000430  6c 73 65 0a 09 09 6e 6f  64 65 2d 3e 70 61 72 65  |lse...node->pare|
00000440  6e 74 2d 3e 72 69 67 68  74 20 3d 20 63 68 69 6c  |nt->right = chil|
00000450  64 3b 0a 7d 0a 0a 2f 2a  0a 2a 2a 20 49 20 66 69  |d;.}../*.** I fi|
00000460  72 73 74 20 72 65 70 6c  61 63 65 20 6e 6f 64 65  |rst replace node|
00000470  20 77 69 74 68 20 63 68  69 6c 64 2e 20 53 6f 20  | with child. So |
00000480  69 6e 20 74 68 65 20 73  65 63 6f 6e 64 20 69 66  |in the second if|
00000490  2c 20 6e 6f 64 65 27 73  20 6b 65 79 20 69 73 0a  |, node's key is.|
000004a0  2a 2a 20 63 68 69 6c 64  27 73 20 6b 65 79 2e 20  |** child's key. |
000004b0  4e 6f 74 65 20 74 68 61  74 20 74 68 65 20 63 6f  |Note that the co|
000004c0  6c 6f 72 20 64 69 64 20  6e 6f 74 20 63 68 61 6e  |lor did not chan|
000004d0  67 65 64 2e 0a 2a 2f 0a  73 74 61 74 69 63 20 76  |ged..*/.static v|
000004e0  6f 69 64 09 09 09 64 65  6c 65 74 65 5f 63 68 69  |oid...delete_chi|
000004f0  6c 64 28 74 5f 72 62 5f  74 72 65 65 20 2a 6e 6f  |ld(t_rb_tree *no|
00000500  64 65 29 0a 7b 0a 09 74  5f 72 62 5f 74 72 65 65  |de).{..t_rb_tree|
00000510  09 2a 63 68 69 6c 64 3b  0a 0a 09 63 68 69 6c 64  |.*child;...child|
00000520  20 3d 20 28 6e 6f 64 65  2d 3e 72 69 67 68 74 20  | = (node->right |
00000530  3d 3d 20 4e 55 4c 4c 29  20 3f 20 6e 6f 64 65 2d  |== NULL) ? node-|
00000540  3e 6c 65 66 74 20 3a 20  6e 6f 64 65 2d 3e 72 69  |>left : node->ri|
00000550  67 68 74 3b 0a 09 69 66  20 28 63 68 69 6c 64 20  |ght;..if (child |
00000560  21 3d 20 4e 55 4c 4c 29  0a 09 09 72 65 70 6c 61  |!= NULL)...repla|
00000570  63 65 5f 6e 6f 64 65 28  6e 6f 64 65 2c 20 63 68  |ce_node(node, ch|
00000580  69 6c 64 29 3b 0a 09 65  6c 73 65 0a 09 09 63 68  |ild);..else...ch|
00000590  69 6c 64 20 3d 20 6e 6f  64 65 3b 0a 09 69 66 20  |ild = node;..if |
000005a0  28 6e 6f 64 65 2d 3e 63  6f 6c 6f 72 20 3d 3d 20  |(node->color == |
000005b0  42 4c 41 43 4b 29 0a 09  7b 0a 09 09 69 66 20 28  |BLACK)..{...if (|
000005c0  63 68 69 6c 64 2d 3e 63  6f 6c 6f 72 20 3d 3d 20  |child->color == |
000005d0  52 45 44 29 0a 09 09 09  63 68 69 6c 64 2d 3e 63  |RED)....child->c|
000005e0  6f 6c 6f 72 20 3d 20 42  4c 41 43 4b 3b 0a 09 09  |olor = BLACK;...|
000005f0  65 6c 73 65 0a 09 09 09  64 65 6c 65 74 65 5f 63  |else....delete_c|
00000600  61 73 65 5f 31 28 63 68  69 6c 64 29 3b 0a 09 7d  |ase_1(child);..}|
00000610  0a 09 70 72 69 6e 74 5f  72 62 5f 74 72 65 65 28  |..print_rb_tree(|
00000620  67 65 74 5f 72 6f 6f 74  28 6e 6f 64 65 29 2c 20  |get_root(node), |
00000630  30 29 3b 0a 09 66 74 5f  70 72 69 6e 74 66 28 22  |0);..ft_printf("|
00000640  6e 6f 64 65 2d 3e 6b 65  79 20 25 64 5c 74 6e 6f  |node->key %d\tno|
00000650  64 65 20 63 6f 6c 6f 72  20 25 64 5c 6e 63 68 69  |de color %d\nchi|
00000660  6c 64 20 25 64 5c 74 20  63 68 69 6c 64 20 63 6f  |ld %d\t child co|
00000670  6c 6f 72 20 25 64 5c 6e  22 2c 20 6e 6f 64 65 2d  |lor %d\n", node-|
00000680  3e 6b 65 79 2c 20 6e 6f  64 65 2d 3e 63 6f 6c 6f  |>key, node->colo|
00000690  72 2c 20 63 68 69 6c 64  2d 3e 6b 65 79 2c 20 63  |r, child->key, c|
000006a0  68 69 6c 64 2d 3e 63 6f  6c 6f 72 29 3b 0a 09 66  |hild->color);..f|
000006b0  72 65 65 28 6e 6f 64 65  29 3b 0a 09 6e 6f 64 65  |ree(node);..node|
000006c0  20 3d 20 4e 55 4c 4c 3b  0a 09 2f 2f 20 69 66 20  | = NULL;..// if |
000006d0  28 6e 6f 64 65 20 3d 3d  20 67 65 74 5f 70 61 72  |(node == get_par|
000006e0  65 6e 74 28 6e 6f 64 65  29 2d 3e 6c 65 66 74 29  |ent(node)->left)|
000006f0  0a 09 2f 2f 20 09 66 74  5f 6d 65 6d 64 65 6c 28  |..// .ft_memdel(|
00000700  28 76 6f 69 64 2a 2a 29  26 28 67 65 74 5f 70 61  |(void**)&(get_pa|
00000710  72 65 6e 74 28 6e 6f 64  65 29 2d 3e 6c 65 66 74  |rent(node)->left|
00000720  29 29 3b 0a 09 2f 2f 20  65 6c 73 65 0a 09 2f 2f  |));..// else..//|
00000730  20 09 66 74 5f 6d 65 6d  64 65 6c 28 28 76 6f 69  | .ft_memdel((voi|
00000740  64 2a 2a 29 26 28 67 65  74 5f 70 61 72 65 6e 74  |d**)&(get_parent|
00000750  28 6e 6f 64 65 29 2d 3e  72 69 67 68 74 29 29 3b  |(node)->right));|
00000760  0a 7d 0a 0a 73 74 61 74  69 63 20 74 5f 72 62 5f  |.}..static t_rb_|
00000770  74 72 65 65 09 2a 73 77  61 70 5f 6b 65 79 5f 77  |tree.*swap_key_w|
00000780  69 74 68 5f 73 75 63 63  65 73 73 6f 72 28 74 5f  |ith_successor(t_|
00000790  72 62 5f 74 72 65 65 20  2a 6e 6f 64 65 2c 20 69  |rb_tree *node, i|
000007a0  6e 74 33 32 5f 74 20 6b  65 79 29 0a 7b 0a 09 74  |nt32_t key).{..t|
000007b0  5f 72 62 5f 74 72 65 65  09 2a 74 6f 5f 64 65 6c  |_rb_tree.*to_del|
000007c0  65 74 65 3b 0a 09 74 5f  72 62 5f 74 72 65 65 09  |ete;..t_rb_tree.|
000007d0  2a 73 75 63 63 65 73 73  6f 72 3b 0a 0a 09 77 68  |*successor;...wh|
000007e0  69 6c 65 20 28 6b 65 79  20 21 3d 20 6e 6f 64 65  |ile (key != node|
000007f0  2d 3e 6b 65 79 29 0a 09  7b 0a 09 09 6e 6f 64 65  |->key)..{...node|
00000800  20 3d 20 28 6b 65 79 20  3e 20 6e 6f 64 65 2d 3e  | = (key > node->|
00000810  6b 65 79 29 20 3f 20 6e  6f 64 65 2d 3e 72 69 67  |key) ? node->rig|
00000820  68 74 20 3a 20 6e 6f 64  65 2d 3e 6c 65 66 74 3b  |ht : node->left;|
00000830  0a 09 7d 0a 09 74 6f 5f  64 65 6c 65 74 65 20 3d  |..}..to_delete =|
00000840  20 6e 6f 64 65 3b 0a 09  73 75 63 63 65 73 73 6f  | node;..successo|
00000850  72 20 3d 20 28 6e 6f 64  65 2d 3e 72 69 67 68 74  |r = (node->right|
00000860  20 21 3d 20 4e 55 4c 4c  29 20 3f 20 6e 6f 64 65  | != NULL) ? node|
00000870  2d 3e 72 69 67 68 74 20  3a 20 6e 6f 64 65 3b 0a  |->right : node;.|
00000880  09 77 68 69 6c 65 20 28  73 75 63 63 65 73 73 6f  |.while (successo|
00000890  72 2d 3e 6c 65 66 74 20  21 3d 20 4e 55 4c 4c 29  |r->left != NULL)|
000008a0  0a 09 7b 0a 09 09 73 75  63 63 65 73 73 6f 72 20  |..{...successor |
000008b0  3d 20 73 75 63 63 65 73  73 6f 72 2d 3e 6c 65 66  |= successor->lef|
000008c0  74 3b 0a 09 7d 0a 09 74  6f 5f 64 65 6c 65 74 65  |t;..}..to_delete|
000008d0  2d 3e 6b 65 79 20 3d 20  73 75 63 63 65 73 73 6f  |->key = successo|
000008e0  72 2d 3e 6b 65 79 3b 0a  09 74 6f 5f 64 65 6c 65  |r->key;..to_dele|
000008f0  74 65 20 3d 20 73 75 63  63 65 73 73 6f 72 3b 0a  |te = successor;.|
00000900  09 72 65 74 75 72 6e 20  28 74 6f 5f 64 65 6c 65  |.return (to_dele|
00000910  74 65 29 3b 0a 7d 0a 0a  74 5f 72 62 5f 74 72 65  |te);.}..t_rb_tre|
00000920  65 09 09 09 2a 64 65 6c  65 74 65 28 74 5f 72 62  |e...*delete(t_rb|
00000930  5f 74 72 65 65 20 2a 6e  6f 64 65 2c 20 69 6e 74  |_tree *node, int|
00000940  33 32 5f 74 20 6b 65 79  29 0a 7b 0a 09 74 5f 72  |32_t key).{..t_r|
00000950  62 5f 74 72 65 65 09 2a  74 6f 5f 64 65 6c 65 74  |b_tree.*to_delet|
00000960  65 3b 0a 0a 09 69 66 20  28 6e 6f 64 65 20 21 3d  |e;...if (node !=|
00000970  20 4e 55 4c 4c 29 0a 09  7b 0a 09 09 74 6f 5f 64  | NULL)..{...to_d|
00000980  65 6c 65 74 65 20 3d 20  73 77 61 70 5f 6b 65 79  |elete = swap_key|
00000990  5f 77 69 74 68 5f 73 75  63 63 65 73 73 6f 72 28  |_with_successor(|
000009a0  6e 6f 64 65 2c 20 6b 65  79 29 3b 0a 09 09 64 65  |node, key);...de|
000009b0  6c 65 74 65 5f 63 68 69  6c 64 28 74 6f 5f 64 65  |lete_child(to_de|
000009c0  6c 65 74 65 29 3b 0a 09  09 6e 6f 64 65 20 3d 20  |lete);...node = |
000009d0  67 65 74 5f 72 6f 6f 74  28 6e 6f 64 65 29 3b 0a  |get_root(node);.|
000009e0  09 7d 0a 09 72 65 74 75  72 6e 20 28 6e 6f 64 65  |.}..return (node|
000009f0  29 3b 0a 7d 0a                                    |);.}.|
000009f5
